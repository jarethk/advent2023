Part 1 - I had lots of great ideas on this one.  I found ways to auto-associate blocks of the first part of the input with blocks of the checks.  But that breaks down with the permutations of the more complex variations in the full input.  So I try a hybrid approach with auto-matching what can, and doing permutations on what doesn't, and just can't seem to get the logic right.  So finally for part 1 I brute force it, doing a DFS with regex of every variant translating ? to . or #.  Slow but effective.

Part 2 - yeah, no way brute force will work.  Can't even process the first input in a reasonable time.  Looking more closely at some of the discussions and solutions on redit, I see many people giving complex logic solutions.  Then I find one who's logic has parts that are similar to mine, but many fewer conditions and I realize how over-complicated I was making things.  Simpler logic, faster processing.  And it works too.